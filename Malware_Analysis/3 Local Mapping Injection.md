Local Mapping Injection uses `CreateFileMapping` to create a file mapping object, next `MapViewOfFile` is called to map the file mapping object into the local process address space. Next the payload is copied to mapped memory.

# Summary

We are going to analyse this binary with Binary Ninja & IDA Pro

Within this code, a main function held sway at memory address `1400010fb`, orchestrating the malware's actions. Supported by a subroutine  at `14000112d`.

 A pause in execution prompted by a user prompt, facilitated by a simple `getchar()` command, provided a momentary interruption. Discovered the creation of threads through `CreateThread()` and `WaitForSingleObject()`.
## Binary Ninja Analysis

### Main() Function Part 1

Mine mythology is to analyse the `main()` subroutine first, this allows to have a good understanding on how this specimen work without going to deep right a way. (which I will do once I analyse ``main()``).

Binary Ninja is able to detect the main function of the specimen. We can see at memory location: `14000112d` that there is a another subroutine called named: `gaadisdadhsa`. Before we continue to further analyse the `main()` function, I want to dive into this other subroutine.

![[Pasted image 20240502221004.png]]

### gaadisdadhsa() Subroutine

We can see are able to determine that the subroutine accepts 3 parameters;
1. pPayload -> Pointer to payload memory address.
2. sPayloadSize -> Size of payload (in bytes).
3. ppAddress -> Double pointer to base address of our payload.

This function (`140001052`) will create an **new** file mapping object with RWX permissions (ReadWriteExecute) it needs to have execute permissions to run our payload, also `dwMaximumSizeLow` is set to our size of your payload. (`dwMaximumSizeLow` -> low-order 32 bits of the maximum size of the file mapping object. In a 32-bit unsigned integer, the low-order 16 bits refer to the least significant 16 bits of the number, and the high-order 16 bits refer to the most significant 16 bits.) I have added quite a lot of comments to analyse line by line.

![[Pasted image 20240502223220.png]]
### Main() Part 2

We have now analysed the subroutine that the main function is called at: `14000112d`. After this subroutine is called, the program waits on the user to press `<Enter>`. After the user has pressed enter, the main function will continue with its next instruction which is creating a thread. Once the handle is valid, the program waits indefinitely for the thread to complete its execution.

![[Pasted image 20240503124644.png]]


# IDA Pro

### gaadisdadhsa() Subroutine

![[Pasted image 20240503130119.png]]
![[Pasted image 20240503130154.png]]